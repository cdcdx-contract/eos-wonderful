# EOS-Wonderful 황서
작성자: 김선태(S/W Specialist), 이준희(Infosec Specialist)

소속 : (주) 원더풀플랫폼 블록체인 사업부

- - -
# 프로젝트 요약 - 이오스원더풀

## 목적
 실생활에 적용이 가능한 dApp(분산 어플리케이션, 이하 댑)을 제작함에 있어 현재의 (EOSIO/블록체인 기술)을 이용함에 있어서는 몇 가지 어려움이 따른다. 우선 첫번째로 계정 생성과 자원 할당에 필요한 비용의 부담이 적지 않으며, 두 번째로 일반 사용자가 블록체인을 이용함에 있어 접근성이 어렵다. 누군가는 이러한 어려움이 있기 때문에 프라이빗 블록체인을 구성하고자 하는데 이는 1차원적인 해결이며 궁극적으로는 다른 방법을 모색해야만 한다.


 이오스원더풀은 위와 같은 어려움을 해소하고 실생활에 적용이 가능한 댑을 만들 수 있는 플랫폼을 제공한다. 이 때 '플랫폼'이라 함은 단순히 서비스 제공자(개발자 포함) 뿐만 아니라 일반 사용자들이 손쉽게 댑을 이용할 수 있는 방법 또한 포함된다.

## 목표
이오스원더풀은 위 '목적'을 달성하기 위해 다음과 같은 점을 목표로 개발을 진행 중이다.
1.	블록체인의 중요 요소인 '탈중앙성'을 만족하기 위해 퍼블릭(EOS 메인넷)과 이오스원더풀 플랫폼을 연동한다.
2.	서비스 제공자(개발자)가 소비해야 하는 필요 비용을 최소화한다.
3.	일반 사용자의 접근성을 높히기 위한 클라이언트 SDK를 제공한다.
4.	접근성을 지속하기 위한 서버 SDK를 제공한다,
5.	이오스원더풀의 영속성을 위해 필요한 모든 소스들을 깃허브에 공개하고 알맞은 라이센스를 지정한다.


## 솔루션
<img src="https://github.com/humblefirm/eos-wonderful/blob/master/papers/images/EWKAS.png" width="100%"></img>  
> [좌]기존 이오스 계정의 구조, [우]이오스원더풀 컨트랙트가 적용된 계정의 구조.  

 비용 절감을 위해 모두가 계정을 생성하지 않는다. 하나의 계정을 모두가 공유하기 때문에 자원도 효율적으로 사용된다. 하나의 계정을 공유하면서 생기는 각종 문제를 해결하기 위해 이중검증을 통해 사용자를 구별한다. 이중검증은 이오스원더풀 계정내에 스마트컨트랙으로 구현되어 있다.

## 프로젝트 개요
### 현황 분석
 이오스원더풀은 실생활에 사용이 가능한 퍼블릭 체인 기반의 댑 운영을 위해 설계되고 제작되었습니다.  
 
 EOS 메인넷을 사용하기 위해서 사용자는 EOS 계정이 필요합니다. EOS 계정을 생성하기 위해서는 이미 계정이 있는 사람이 약 2천원 가량의 비용을 지불해야 합니다. 예들들어, EOS의 가격은 현재 약 6370원이고, 계정 생성에 필요한 3200 byte의 RAM이 약 0.3 EOS로 제일 많은 양을 차지하고, 10회 전송이 가능한 자원을 할당하는데에 약 0.04 EOS 정도 추가 비용이 들어갑니다. 총 0.34 EOS 가량 소모되며, 원화로는 2135원 입니다. 자원 평균 사용률이 10%인 경우 이오스원더풀을 적용하면 RAM 사용률은 3200byte -> 203byte로 줄고, 자원 할당에 필요한 금액은 0.04EOS -> 0.004EOS 로 줄기 때문에 총 145원의 돈이 필요하게 됩니다.  
 
 또한, EOS 네트워크에 부하가 없다는 전제하에서, 계정이 자원을 얻기 위해서는 적지 않은 돈을 “홀딩”해야 합니다. “홀딩”된 돈을 회수하기 위해서는 최소 3일 이상이 소요되며, 수차례 전송하는 수준의 많은 자원을 소모하기 때문에 홀딩되는 자원의 유동성을 확보하기가 어렵습니다.  
 
 서비스 운영시 대부분의 계정은 휴면 계정으로서 대부분의 홀딩된 금액은 사용하지 않는 잉여 자원이 되어버립니다. 그외에 서비스를 이용하는 비휴면 고객은 자원이 부족한 상황이 생기게 됩니다.  
 
 즉, 높은 계정 생성비와 비효율적인 자원 할당으로 인한 낭비, 그리고 계정을 생성하고 사용할 때 부딪히는 접근성 난이도 문제는 실생활에 사용되는 댑을 만들 때 큰 걸림돌이 됩니다.  


### 용어정리
**이중검증** - 계정을 공유하는 다수의 사용자를 식별할 수 있도록 한 차례 더 서명 검증을 거치는 방법, 이오스원더풀의 핵심 기능임  
**E-W 스마트컨트랙** - 이중검증 및 사용자 데이터 관리 기능과 댑 관련 기능이 포함되어 있는 스마트컨트랙트 코드  
**E-W 계정** - 이오스원더풀 스마트컨트랙이 적용된 EOS 계정, 탈중앙화가 가능하지만 기본값인 경우 계정의 소유주가 관리 및 설정 권한을 가짐  
**서버 계정** - 계정이 없는 사용자에게 자원을 빌려주는 계정, 사용하지 않는 자원을 소모하고 보상으로 수수료를 받음  
**클라이언트 SDK** - 사용자 어플리케이션이 서버 계정을 통해 이오스원더풀 계정과 통신하기 위한 기능을 가진 개발 키트  
**서버 SDK** - 클라이언트 SDK가 소모할 자원을 가진 계정을 빌려 주기 위한 개발 키트  

### 개요
 이오스원더풀을 이용하면, 계정이 없는 사용자도 댑을 이용할 수 있게 됩니다. 이오스원더풀 계정에서 모든 사용자의 정보가 관리되지만, 해당 계정은 탈중앙화되어 있고 스마트컨트랙 이중검증을 통해 사용자를 식별함으로써 보안 문제가 생기지 않으며, 기존의 계정을 사용하는 것과 동일한 탈중앙성이 보장됩니다. 이오스원더풀 계정의 자원이 모두 소모되거나 계정 제공 서버가 Down 되는 경우에도, 다른 EOS 계정, 혹은 EOS 계정이 있는 제 3자가 오픈한 서버 SDK를 이용하여 즉시 서비스를 재개할 수 있으며, 이 경우에도 보안 및 탈중앙성이 손상되지 않습니다. 개인의 식별은 트랜잭션의 생성자가 아닌 이중검증을 통해 진행되기 때문입니다. 결과적으로, EOS 체인이 유지되는 한 이오스원더풀은 접근성/탈중앙성/보안성/무결성이 지속됩니다.  
 
 이오스원더풀의 주요 구성 요소는 크게 이중검증/접근성/SDK 3가지로 나눌 수 있습니다.  


### 이중검증
<img src="https://github.com/humblefirm/eos-wonderful/blob/master/papers/images/ETS.png" width="100%"></img>  
> 기존 이오스의 송금 트랜잭션 구조  

 이중검증을 설명하기 전에, EOS의 트랜잭션 검증이 어떻게 이루어지는지 설명하겠습니다. EOS에서 트랜잭션을 생성하기 위해서는 우선 목표하는 행위와 계정을 이용하여 액션을 생성합니다. 이렇게 만들어진 하나 이상의 액션을 트랜잭션에 담고, 트랜잭션 내부의 모든 데이터를 계정의 공개키와 매칭되는 개인키로 서명하여 트랜잭션에 포함시켜 전송합니다. 이후 노드들은 트랜잭션에 적힌 계정명의 공개키로 서명을 해제하여 본인임을 확인합니다.  

 
<img src="https://github.com/humblefirm/eos-wonderful/blob/master/papers/images/EWTS.png" width="100%"></img>  
 > 이오스 원더풀에서의 송금 트랜잭션 구조  
 
 여기서 서명 정보는 트랜잭션 가장 외부에 기록되어 있습니다. 이 부분에서 이중검증과 차이가 있습니다. 이중검증은 트랜잭션의 서명이 정상인 경우, 트랜잭션 내부, 액션 내부, 데이터 내부에 적힌 공개키 정보와 서명 정보를 이용해서 개인을 식별하게 됩니다. 즉 개인을 식별함에 있어서 해당 트랜잭션을 발생시킨 계정이 무엇인지는 전혀 상관이 없으며, 오직 데이터 내부의 서명 정보만으로 개인을 식별하기 때문에 하나의 계정을 여럿이 공유하는 것이 가능합니다.  

### 접근성
 접근성은 아주 중요한 요소 중 하나입니다. 계정을 생성하는 중간 과정을 제외하고, 계정없이 사용하기 위해서 이오스원더풀은 이더리움과 비슷한 키-계정 방식을 이용합니다. 공개키 자체가 계정이 되는 것입니다.  
 
 <img src="https://github.com/humblefirm/eos-wonderful/blob/master/papers/images/EWPI.png" width="100%"></img>  
 > 빠른 멀티인덱스 조회를 위한 Key to Index 방식 
 
 즉각적인 계정의 조회를 위해 공개키의 앞 28비트를 정수형으로 변환하여 인덱스 키로 사용합니다. 따라서 사용자는 자신의 키-계정 데이터를 즉시 조회할 수 있습니다. 만약 이런 설계가 없는 경우에는 사용자가 자신의 데이터를 조회하거나 다른 사람에게 입금하기 위해서는 이오스원더풀 계정을 사용하는 모든 사람의 계정 정보를 조회하고, 자신과 대상자의 키를 대조해서 찾아야 합니다. 이오스원더풀은 EOS를 처음 이용하는 사용자도 중간 단계없이 키쌍 하나로 입금/조회/송금 및 그외에 모든 행위가 즉시 가능해집니다.  

### SDK
 SDK는 이오스원더풀 프로토콜에 맞춰 제작된 툴킷으로서, 댑을 만들거나 제공하기 위해 꼭 필요합니다. 기본적으로, 이중검증된 액션을 생성하기 위해서는 스마트컨트랙의 서명 검증 방식에 대응되는 서명을 생성해야 합니다. 이중검증은 특이한 구조를 지니기 때문에 Replay-attack에 잠재적인 취약성을 갖습니다. 이것을 해결하기 위해 Account-state nonce 개념이 도입되어 있어 트랜잭션 생성 과정이 한 층 더 복잡합니다.  
 
 클라이언트 SDK는 이것을 모두 자동으로 진행하여 액션을 생성해 줍니다. 또한 서버 SDK와 통신하여 타인의 계정을 빌려 트랜잭션을 생성해 전파하고 서비스를 이용하게 됩니다. 서버 SDK는 실제로 트랜잭션을 생성하기 위한 자원을 소모하는 계정을 사용자에게 제공하기 위해 필요합니다. 클라이언트는 서버SDK가 적용된 서버에 연결해 자신이 생성한 액션을 실제 계정의 자원을 이용하여 트랜잭션화-전송하게 됩니다.  
 
 동시에 서버 SDK는 탈중앙성의 가장 중요한 요소인 구조적 탈중앙화를 유지하고 서비스의 영속을 유지하기 위해 필요합니다. 이오스원더풀에서 실제 자원을 소모하는 것은 트랜잭션을 생성하는 서버 계정입니다. 그리고 이 계정과 계정에 할당된 자원은 보통 댑을 제공하는 회사에서 구비하게 됩니다.  
 
 여기서 문제가 생깁니다. “댑을 제공하는 회사”가 계정의 자원을 확보하지 않거나 서버 계정을 Down시켜 탈중앙화 시킨 스마트컨트랙 기반의 서비스를 임의로 중단할 수 있습니다. 하지만 이 경우 EOS 계정을 가진 사람은 누구든지 자신의 계정과 자동화된 서버 SDK를 이용해 서비스를 재개할 수 있습니다.  
 
 서비스를 제공함으로서 소모되는 자원은 이오스원더풀 수수료 정책에 따라 보상으로 돌려 받습니다. 이는 평소에도 회사 계정 서버 외에도 여러 계정 서버가 탄생하고 유지될 수 있는 인센티브를 제공해주며 유저에게 선택권을 제공하고 탈중앙성을 유지하게 됩니다.  
 
 즉, 유저는 자신이 사용하지 않은 계정의 자원을 이오스원더풀에 제공함으로서 “채굴”이 가능해지고, 보상을 받습니다. 궁극적으로는 생태계의 발전에 이바지하게 됩니다.  


- - -
